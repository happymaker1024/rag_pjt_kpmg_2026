<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wine Pairing</title>

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Project styles -->
    <link href="/static/css/style.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container py-5">

    <h1 class="mb-4 text-center">ğŸ· Wine Pairing</h1>

    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ í¼ -->
    <form id="uploadForm" class="card p-4 shadow-sm" enctype="multipart/form-data">
        <div class="mb-3">
            <label class="form-label">ìš”ë¦¬ ì´ë¯¸ì§€ ì„ íƒ</label>
            <input class="form-control" type="file" name="file" accept="image/*" required>
        </div>

        <div class="row g-2">
            <div class="col">
                <button type="submit" class="btn btn-primary w-100">
                    ì™€ì¸ ì¶”ì²œ ë°›ê¸°
                </button>
            </div>

            <div class="col">
                <button type="reset" class="btn btn-outline-secondary w-100">
                    ë‹¤ì‹œí•˜ê¸°
                </button>
            </div>
        </div>
    </form>

<!-- ê²°ê³¼ ì¶œë ¥ -->
<div id="result" class="card mt-4 d-none">
    <div class="card-body text-center">

        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div id="loading" class="my-3 d-none">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 mb-0">ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- ê²°ê³¼ ë‚´ìš© -->
        <div id="resultContent" class="d-none text-start">
            <h5 class="card-title mb-3">ğŸ· ì¶”ì²œ ì™€ì¸</h5>
            <h6 class="fw-bold text-primary" id="wineName"></h6>
            <p class="mt-3 mb-0" id="wineReason"></p>
        </div>

        <!-- ì—ëŸ¬ -->
        <div id="errorMsg" class="text-danger d-none"></div>

    </div>
</div>

<script>
document.getElementById("uploadForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const submitBtn = this.querySelector('[type="submit"]');

    const resultDiv = document.getElementById("result");
    const loading = document.getElementById("loading");
    const content = document.getElementById("resultContent");
    const errorMsg = document.getElementById("errorMsg");

    // ì´ˆê¸° ìƒíƒœ
    submitBtn.disabled = true;
    resultDiv.classList.remove("d-none");
    loading.classList.remove("d-none");
    content.classList.add("d-none");
    errorMsg.classList.add("d-none");

    try {
        const response = await fetch("/wine-pairing", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.detail || "ì„œë²„ ì˜¤ë¥˜");
        }

        // ê²°ê³¼ ë Œë”ë§
        renderResult(data.result);

        loading.classList.add("d-none");
        content.classList.remove("d-none");

    } catch (err) {
        loading.classList.add("d-none");
        errorMsg.innerText = err.message;
        errorMsg.classList.remove("d-none");
    } finally {
        submitBtn.disabled = false;
    }
});

function renderResult(data) {
    document.getElementById("wineName").innerText =
        data.recommend_wine;

    document.getElementById("wineReason").innerText =
        data.recommend_reason;
}
</script>


<!-- Bootstrap JS (optional, for interactive components) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
